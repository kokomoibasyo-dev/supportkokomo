<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­ã©ã‚‚ã‚µãƒãƒ¼ãƒˆãƒ»ãƒŠãƒ“</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --mi-color: #ff7f7f; --ki-color: #ffb347; --ka-color: #76ba1b; --to-color: #4db8ff;
            --bg-color: #fffaf0; --text: #444;
        }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-color); color: var(--text); margin: 0; padding: 10px; display: block; }
        .container { max-width: 600px; width: 100%; margin: 20px auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); border: 2px solid #eee; box-sizing: border-box;}
        
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-size: 1.6rem; color: #d48344; margin: 10px 0; }
        .intro-box { background: #fff5e6; border-radius: 15px; padding: 15px; font-size: 0.85rem; line-height: 1.6; border: 1px solid #f9e2c4; text-align: left; margin-bottom: 20px; }
        .intro-box strong { color: #d48344; }

        .tab-menu { display: flex; gap: 4px; margin-bottom: 20px; width: 100%; }
        .tab-btn { flex: 1; padding: 10px 2px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: #f0f0f0; transition: 0.3s; font-family: inherit; font-size: 0.75rem; color: #888; }
        .tab-btn.active { color: white; }
        .tab-btn[data-tab="mi"].active { background: var(--mi-color); }
        .tab-btn[data-tab="kishitsu"].active { background: var(--ki-color); }
        .tab-btn[data-tab="kankyo"].active { background: var(--ka-color); }
        .tab-btn[data-tab="total"].active { background: var(--to-color); }
        .tab-btn:disabled { opacity: 0.3; }

        .tab-content { display: none; animation: fadeIn 0.4s; width: 100%; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .q-block { margin-bottom: 20px; padding: 15px; border-radius: 15px; border: 1px solid #eee; background: #fff; }
        .q-text { font-weight: bold; font-size: 0.95rem; margin-bottom: 12px; display: block; color: #333; }
        
        .radio-group { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .radio-label { text-align: center; font-size: 0.65rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .radio-label input { margin-bottom: 8px; width: 22px; height: 22px; cursor: pointer; }

        .btn { width: 100%; padding: 16px; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
        .btn-save { background: #999; margin-top: 10px; font-size: 0.9rem; }
        
        .res-area { margin-top: 20px; padding: 20px; border-radius: 20px; display: none; border-left: 8px solid; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .total-card { padding: 15px; border-radius: 20px; background: white; }
        .summary-box { background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eee; border-left: 8px solid #ccc; font-size: 0.9rem; }
        
        .praise-box { background: #fffcf0; border: 1px dashed #ffb347; padding: 12px; border-radius: 10px; margin-top: 10px; font-size: 0.85rem; }
        .message-box { background: #f0f7ff; padding: 20px; border-radius: 15px; border: 2px solid #4db8ff; font-size: 0.9rem; line-height: 1.7; margin-top: 20px; position: relative;}
        .message-box::before { content: "ğŸ’Œ"; position: absolute; top: -15px; left: 20px; font-size: 1.5rem; background: white; padding: 0 5px; }

        #chart-container { width: 100%; max-width: 350px; margin: 15px auto; }
        
        @media print { .tab-menu, .btn, .intro-box, .q-block { display: none !important; } .container { border: none; box-shadow: none; } }
    </style>
</head>
<body>

<div class="container" id="app-container">
    <div class="header">
        <h1>ğŸŒ± å­ã©ã‚‚ã‚µãƒãƒ¼ãƒˆãƒ»ãƒŠãƒ“</h1>
    </div>

    <div class="intro-box">
        <div style="text-align: center; border-bottom: 1px solid #f9e2c4; margin-bottom: 15px; padding-bottom: 10px;">
            <strong style="color: #e67e22; font-size: 1rem;">ğŸ›¡ï¸ å¤§åˆ‡ãªã€Œ3ã¤ã®NOã€</strong><br>
            <span style="font-size: 0.8rem;">
                âŒ <strong>è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“</strong>ï¼ˆåŒ»å­¦çš„ãªåˆ¤æ–­ã¯è¡Œã„ã¾ã›ã‚“ï¼‰<br>
                âŒ <strong>æ±ºã‚ã¤ã‘ã¾ã›ã‚“</strong>ï¼ˆãŠå­ã•ã‚“ã®å¯èƒ½æ€§ã‚’å›ºå®šã—ã¾ã›ã‚“ï¼‰<br>
                âŒ <strong>å›ºå®šã—ã¾ã›ã‚“</strong>ï¼ˆæˆé•·ã¨ã¨ã‚‚ã«çµæœã¯å¤‰åŒ–ã—ã¾ã™ï¼‰
            </span>
        </div>

        ğŸ•Šï¸ <strong>ã“ã®ãƒ„ãƒ¼ãƒ«ã®ç›®çš„</strong><br>
        ã€Œãªãœã€ã‚ã‚“ãªè¡Œå‹•ã‚’ã™ã‚‹ã‚“ã ã‚ã†ï¼Ÿã€ã¨ã„ã†ç–‘å•ã‚’<strong>ã€Œç†è§£ã®ãƒ’ãƒ³ãƒˆã€</strong>ã«å¤‰ãˆã€è¦ªå­ãŒã‚‚ã£ã¨æ¥½ã«ã€è‡ªåˆ†ã‚‰ã—ãç¬‘ã„åˆãˆã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ¢ã‚‹ãŸã‚ã®ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚<br><br>
        
        ğŸ“Œ <strong>å¯¾è±¡å¹´é½¢ã®ç›®å®‰ï¼š3æ­³ ã€œ 12æ­³é ƒ</strong><br><br>

        ğŸŒ± <strong>0ã€œ2æ­³ã®ãŠå­ã•ã‚“ã®ã”å®¶æ—ã¸</strong><br>
        ç™ºé”ã®å€‹äººå·®ãŒã¨ã¦ã‚‚å¤§ãã„æ™‚æœŸã§ã™ã€‚ã€Œä»Šã¯ã“ã‚“ãªå‚¾å‘ãªã®ã‹ãªï¼Ÿã€ã¨ã€ä»Šã‚’æ„›ã§ã‚‹ãƒ’ãƒ³ãƒˆã«ã—ã¦ãã ã•ã„ã€‚<br><br>

        ğŸ“ <strong>13æ­³ä»¥ä¸Šã®ãŠå­ã•ã‚“ã®ã”å®¶æ—ã¸</strong><br>
        æ€æ˜¥æœŸä»¥é™ã¯æœ¬äººã®ä¸»è¦³ãŒå¤§åˆ‡ã«ãªã‚Šã¾ã™ã€‚çµæœã‚’æœ¬äººã¨ä¸€ç·’ã«çœºã‚ã¦ã€Œè‡ªåˆ†ã§ã¯ã©ã†æ€ã†ï¼Ÿã€ã¨å¯¾è©±ã®ãã£ã‹ã‘ã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
    </div>

    <div class="tab-menu">
        <button class="tab-btn active" data-tab="mi">âœ¨ãã‚‰ã‚Š<br>(å¼·ã¿)</button>
        <button class="tab-btn" data-tab="kishitsu">ğŸŒˆã“ã“ã‚<br>(æ€§æ ¼)</button>
        <button class="tab-btn" data-tab="kankyo">ğŸ ãã‚‰ã—<br>(ç’°å¢ƒ)</button>
        <button class="tab-btn" data-tab="total" id="total-btn" disabled>ğŸ“Š ç·åˆè¨ºæ–­</button>
    </div>

    <div id="mi" class="tab-content active">
        <p style="text-align:center; font-size:0.9rem;">ğŸ¨ ãŠå­ã•ã‚“ã®ã€Œã“ã‚Œã€å¥½ãã‹ã‚‚ï¼ã€ã‚’é¸ã‚“ã§ã­</p>
        <div id="mi-q"></div>
        <button class="btn" style="background:var(--mi-color)" onclick="calcMI()">å¼·ã¿ã®ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹ ğŸ”</button>
        <div id="chart-container"><canvas id="miChart"></canvas></div>
        <div id="mi-res" class="res-area" style="background:#fffafa; border-color:var(--mi-color)"></div>
    </div>

    <div id="kishitsu" class="tab-content">
        <p style="text-align:center; font-size:0.9rem;">ğŸƒ ç”Ÿã¾ã‚ŒæŒã£ãŸã€Œå¿ƒã®ã‚¯ã‚»ã€ã‚’æ•™ãˆã¦ã­</p>
        <div id="ki-q"></div>
        <button class="btn" style="background:var(--ki-color)" onclick="calcKi()">æ°—è³ªã®ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹ ğŸ”</button>
        <div id="ki-res" class="res-area" style="background:#fffdf5; border-color:var(--ki-color)"></div>
    </div>

    <div id="kankyo" class="tab-content">
        <p style="text-align:center; font-size:0.9rem;">ğŸ›‹ï¸ æ—¥å¸¸ã®ã€Œã¡ã‚‡ã£ã¨å›°ã£ãŸã€ã®èƒŒæ™¯ã‚’æ¢ã‚ã†</p>
        <div id="ka-q"></div>
        <button class="btn" style="background:var(--ka-color)" onclick="calcKa()">ç’°å¢ƒã®ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹ ğŸ”</button>
        <div id="ka-res" class="res-area" style="background:#fafffa; border-color:var(--ka-color)"></div>
    </div>

    <div id="total" class="tab-content">
        <div class="total-card" id="capture-area">
            <h2 style="text-align:center; color:var(--to-color); font-size:1.3rem;">ğŸ¤ ãŠå­ã•ã‚“ã¸ã®ä¼´èµ°ã‚¬ã‚¤ãƒ‰</h2>
            <div id="total-content"></div>
        </div>
        <button class="btn" style="background:var(--to-color)" onclick="window.print()">ğŸ–¨ï¸ çµæœã‚’å°åˆ·ã™ã‚‹</button>
        <button class="btn btn-save" onclick="saveImage()">ğŸ“¸ ã‚¹ãƒãƒ›ã«ç”»åƒã§ä¿å­˜</button>
    </div>

    <div style="text-align: center; font-size: 0.7rem; color: #999; margin-top: 30px; border-top: 1px solid #eee; padding-top: 15px;">
        â€»æœ¬ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒãƒ¯ãƒ¼ãƒ‰ãƒ»ã‚¬ãƒ¼ãƒ‰ãƒŠãƒ¼ã®MIç†è«–ãŠã‚ˆã³å…ç«¥å¿ƒç†å­¦ã®æ°—è³ªç†è«–ã‚’å‚è€ƒã«åˆ¶ä½œã•ã‚ŒãŸå®¶åº­å‘ã‘æ”¯æ´ãƒ’ãƒ³ãƒˆã§ã™ã€‚åŒ»ç™‚æ©Ÿé–¢ã«ã‚ˆã‚‹è¨ºæ–­ã«ä»£ã‚ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
    </div>
</div>

<script>
function create5Scale(name) {
    return `
    <div class="radio-group">
        <label class="radio-label"><input type="radio" name="${name}" value="4">ã‚ˆã<br>ã‚ã¦ã¯ã¾ã‚‹</label>
        <label class="radio-label"><input type="radio" name="${name}" value="3">ã‚ã¦ã¯ã¾ã‚‹</label>
        <label class="radio-label"><input type="radio" name="${name}" value="2">ã‚ã‹ã‚‰<br>ãªã„</label>
        <label class="radio-label"><input type="radio" name="${name}" value="1">ã‚ã¾ã‚Š<br>ã‚ã¦ã¯ã¾ã‚‰ãªã„</label>
        <label class="radio-label"><input type="radio" name="${name}" value="0">ã‚ã¦ã¯ã¾<br>ã‚‰ãªã„</label>
    </div>`;
}

// è³ªå•ãƒ‡ãƒ¼ã‚¿
const miData = [
    { c: "è¨€èª", q: "ğŸ“š é›£ã—ã„è¨€è‘‰ã‚’ä½¿ã£ãŸã‚Šã€ãŠã—ã‚ƒã¹ã‚Šã‚’æ¥½ã—ã‚“ã ã‚Šã™ã‚‹" }, { c: "è¨€èª", q: "ğŸ“– çµµæœ¬ã®èª­ã¿èã‹ã›ã‚„ã€ç‰©èªã‚’ä½œã‚‹ã®ãŒå¥½ã" },
    { c: "è«–ç†", q: "ğŸ§© ãƒ‘ã‚ºãƒ«ã‚„ã€ãƒ¢ãƒã‚’ä¸¦ã¹ã¦åˆ†é¡ã™ã‚‹ã®ãŒå¾—æ„" }, { c: "è«–ç†", q: "ğŸ” ã€Œãªãœï¼Ÿã©ã†ã—ã¦ï¼Ÿã€ã¨ä»•çµ„ã¿ã‚’çŸ¥ã‚ŠãŸãŒã‚‹" },
    { c: "ç©ºé–“", q: "ğŸ—ºï¸ åœ°å›³ã‚’è¦šãˆãŸã‚Šã€çµµã®å¥¥è¡Œãã‚’æ‰ãˆã‚‹ã®ãŒä¸Šæ‰‹" }, { c: "ç©ºé–“", q: "ğŸ° ãƒ–ãƒ­ãƒƒã‚¯ã‚„ãƒ¬ã‚´ã§ç«‹ä½“çš„ãªãƒ¢ãƒã‚’ä½œã‚‹ã®ãŒå¥½ã" },
    { c: "èº«ä½“", q: "ğŸƒâ€â™‚ï¸ ãƒ€ãƒ³ã‚¹ã‚„ã‚¹ãƒãƒ¼ãƒ„ã€ä½“ã®ä½¿ã„æ–¹ãŒå™¨ç”¨" }, { c: "èº«ä½“", q: "âœ‚ï¸ å·¥ä½œã‚„æ–™ç†ãªã©ã€æ‰‹å…ˆã‚’ç´°ã‹ãå‹•ã‹ã™ã®ãŒå¾—æ„" },
    { c: "éŸ³æ¥½", q: "ğŸ¶ é¼»æ­Œã‚’æ­Œã£ãŸã‚Šã€ãƒªã‚ºãƒ ã«ä¹—ã‚‹ã®ãŒè‡ªç„¶ã¨å‡ºã‚‹" }, { c: "éŸ³æ¥½", q: "ğŸ¹ æ¥½å™¨ã‚„ã€ç”Ÿæ´»ã®ä¸­ã®ã€ŒéŸ³ã€ã«æ•æ„Ÿã«åå¿œã™ã‚‹" },
    { c: "å¯¾äºº", q: "ğŸ¤ å‹é”ã®æ°—æŒã¡ã‚’å¯Ÿã—ãŸã‚Šã€ä»²ç›´ã‚Šã•ã›ã‚‹ã®ãŒä¸Šæ‰‹" }, { c: "å¯¾äºº", q: "ğŸ« ã¿ã‚“ãªã¨ä¸€ç·’ã«ä½•ã‹ã‚’ã™ã‚‹æ™‚é–“ã‚’æ¥½ã—ã‚ã‚‹" },
    { c: "å†…çœ", q: "ğŸ§˜ è‡ªåˆ†ã®æ„å¿—ãŒã¯ã£ãã‚Šã—ã¦ã„ã¦ã€æµã•ã‚Œãªã„å¼·ã•ãŒã‚ã‚‹" }, { c: "å†…çœ", q: "ğŸ’­ ã²ã¨ã‚Šã§é™ã‹ã«è€ƒãˆã«æ²¡é ­ã™ã‚‹æ™‚é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹" },
    { c: "åšç‰©", q: "ğŸ¦– æç«œã€æ¤ç‰©ã€çŸ³ãªã©ç‰¹å®šã®åé›†ã‚„è¦³å¯ŸãŒå¤§å¥½ã" }
];

const kiData = [
    { t: "ãƒ‡ãƒªã‚±ãƒ¼ãƒˆ", q: "ğŸ‘‚ éŸ³ã‚„å…‰ã€è‚Œè§¦ã‚Šãªã©ã®åˆºæ¿€ã«ã¨ã¦ã‚‚æ•æ„Ÿ" }, { t: "ãƒ‡ãƒªã‚±ãƒ¼ãƒˆ", q: "ğŸ˜Ÿ å¤±æ•—ã‚’æ€–ãŒã£ãŸã‚Šã€å®Œç’§ã«ã‚„ã‚ŠãŸã„æ°—æŒã¡ãŒå¼·ã„" }, { t: "ãƒ‡ãƒªã‚±ãƒ¼ãƒˆ", q: "ğŸŒ³ åˆã‚ã¦ã®å ´æ‰€ã§ã¯ã€å®‰å…¨ã‚’ç¢ºèªã™ã‚‹ã¾ã§å‹•ã‹ãªã„" },
    { t: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–", q: "ğŸš€ èˆˆå‘³ãŒã‚ã‚‹ã¨è€ƒãˆã‚‹ã‚ˆã‚Šå…ˆã«ä½“ãŒå‹•ã„ã¦ã„ã‚‹" }, { t: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–", q: "ğŸ”¥ å£°ãŒå¤§ããã€å…¨èº«ã‹ã‚‰ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒæº¢ã‚Œã¦ã„ã‚‹" },
    { t: "ã‚¨ãƒ³ã‚¸ã‚§ãƒ«", q: "ğŸŒ¸ åŸºæœ¬çš„ã«ç©ã‚„ã‹ã§ã€å‘¨ã‚Šã®æœŸå¾…ã«å¿œãˆã‚ˆã†ã¨ã™ã‚‹" }, { t: "ã‚¨ãƒ³ã‚¸ã‚§ãƒ«", q: "ğŸ¤ è‡ªåˆ†ã®ä¸»å¼µã‚ˆã‚Šã€ã¿ã‚“ãªã®èª¿å’Œã‚’å„ªå…ˆã•ã›ãŒã¡" },
    { t: "ãƒ†ã‚­ã‚¹ãƒˆ", q: "â° æ±ºã¾ã£ãŸãƒ«ãƒ¼ãƒãƒ³ã‚’å¥½ã¿ã€æ€¥ãªå¤‰æ›´ã¯è‹¦æ‰‹" }, { t: "ãƒ†ã‚­ã‚¹ãƒˆ", q: "ğŸ“‰ ã€Œ10åˆ†ã ã‘ã€ãªã©å…·ä½“çš„ãªæ•°å­—ã‚„ãƒ«ãƒ¼ãƒ«ãŒå®‰å¿ƒã™ã‚‹" },
    { t: "ãƒã‚¬ãƒ†ã‚£ãƒ–", q: "âš¡ æ„Ÿæƒ…ãŒçˆ†ç™ºã™ã‚‹ã¨ã€è½ã¡ç€ãã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚‹" }, { t: "ãƒã‚¬ãƒ†ã‚£ãƒ–", q: "ğŸ’ è‡ªåˆ†ã®ã“ã ã‚ã‚ŠãŒå¼·ãã€ç´å¾—ã—ãªã„ã¨ãƒ†ã‚³ã§ã‚‚å‹•ã‹ãªã„" },
    { t: "ãƒ‡ãƒªã‚±ãƒ¼ãƒˆ", q: "ğŸ‘€ å¤§äººã®è¡¨æƒ…ã‚„ç©ºæ°—ã‚’èª­ã¿ã™ãã¦ç–²ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹" }, { t: "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–", q: "ğŸƒâ€â™‚ï¸ é€€å±ˆãŒè‹¦æ‰‹ã§ã€å¸¸ã«ä½•ã‹ã®åˆºæ¿€ã‚’æ±‚ã‚ã¦ã„ã‚‹" }, { t: "ãƒ†ã‚­ã‚¹ãƒˆ", q: "ğŸ“¦ è‡ªåˆ†ã®å¤§åˆ‡ãªã‚‚ã®ã‚’æ•´ç†ãƒ»æ•´é “ã™ã‚‹ã®ãŒå¥½ã" }, { t: "ã‚¨ãƒ³ã‚¸ã‚§ãƒ«", q: "ğŸ•Šï¸ äº‰ã„ã”ã¨ãŒè‹¦æ‰‹ã§ã€ã¿ã‚“ãªä»²è‰¯ãã„ã¦ã»ã—ã„ã¨é¡˜ã†" }
];

const kaData = [
    { t: "è¦–è¦šæ”¯æ´", q: "ğŸ“¢ è¨€è‘‰ã ã‘ã®æŒ‡ç¤ºã ã¨ã€ã™ãã«å¿˜ã‚Œã¦ã—ã¾ã†" }, { t: "è¦–è¦šæ”¯æ´", q: "ğŸ–¼ï¸ å†™çœŸã‚„ã‚¤ãƒ©ã‚¹ãƒˆã§è¦‹ã›ã¦ã‚‚ã‚‰ã†æ–¹ãŒã‚¹ãƒƒã¨å…¥ã‚‹" }, { t: "è¦–è¦šæ”¯æ´", q: "ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç›®ã«è¦‹ãˆã‚‹ã¨ã“ã‚ã«ã‚ã‚‹ã¨å®‰å¿ƒã™ã‚‹" },
    { t: "è´è¦šé…æ…®", q: "ğŸ‘‚ ã‚¬ãƒ¤ã‚¬ãƒ¤ã—ãŸå ´æ‰€ã ã¨ã€å£°ãŒèãå–ã‚Œãšæ··ä¹±ã™ã‚‹" }, { t: "è´è¦šé…æ…®", q: "ğŸ§ ã‚¤ãƒ¤ãƒ¼ãƒãƒ•ã‚„é™ã‹ãªå ´æ‰€ãŒã‚ã‚‹ã¨ãƒ›ãƒƒã¨ã§ãã‚‹" },
    { t: "æ§‹é€ åŒ–", q: "ğŸ§º ç‰©ã®ç‰‡ä»˜ã‘å ´æ‰€ãŒæ±ºã¾ã£ã¦ã„ãªã„ã¨è¿·å­ã«ãªã‚‹" }, { t: "æ§‹é€ åŒ–", q: "ğŸªœ æ‰‹é †ã‚’ä¸€ã¤ãšã¤ã€Œ1, 2, 3...ã€ã¨åˆ†ã‘ã¦ã»ã—ã„" },
    { t: "æ„Ÿè¦šçµ±åˆ", q: "ğŸ‘• æœã®ã‚¿ã‚°ã‚„ç‰¹å®šã®é£Ÿã¹ç‰©ã®æ„Ÿè§¦ã‚’ã²ã©ãå«ŒãŒã‚‹" }, { t: "æ„Ÿè¦šçµ±åˆ", q: "ğŸŒ€ ãã‚‹ãã‚‹å›ã‚‹ã‚‚ã®ã‚„ã€é«˜ã„ã¨ã“ã‚ãŒå¤§å¥½ã" },
    { t: "å®Ÿè¡Œæ©Ÿèƒ½", q: "â¸ï¸ å¤¢ä¸­ã«ãªã‚‹ã¨ã€æ¬¡ã®è¡Œå‹•ã¸ã®åˆ‡ã‚Šæ›¿ãˆãŒé›£ã—ã„" }, { t: "å®Ÿè¡Œæ©Ÿèƒ½", q: "ğŸ“ å¿˜ã‚Œç‰©ã‚„ã€ç‰©ã®ç´›å¤±ãŒã©ã†ã—ã¦ã‚‚å¤šããªã£ã¦ã—ã¾ã†" }, { t: "å®Ÿè¡Œæ©Ÿèƒ½", q: "â³ æ™‚é–“ã®æµã‚ŒãŒæ´ã¿ã«ããã€ã„ã¤ã‚‚æ…Œã¦ã¦ã—ã¾ã†" },
    { t: "æ„Ÿè¦šçµ±åˆ", q: "ğŸ§¸ ãã‚…ã£ã¨æŠ±ãã—ã‚ã‚‰ã‚Œã‚‹ãªã©ã€åœ§è¿«åˆºæ¿€ã§è½ã¡ç€ã" }, { t: "å®Ÿè¡Œæ©Ÿèƒ½", q: "ğŸ’ æº–å‚™ã‚’ã™ã‚‹éš›ã€ä½•ã‚’ã™ã¹ãã‹é †ç•ªãŒã‚ã‹ã‚‰ãªããªã‚‹" }, { t: "æ§‹é€ åŒ–", q: "ğŸ¤« é›†ä¸­ã—ãŸã„æ™‚ã¯ã€å›²ã‚ã‚ŒãŸé™ã‹ãªãƒ–ãƒ¼ã‚¹ãŒè½ã¡ç€ã" }
];

function setup() {
    const miQ = document.getElementById('mi-q');
    miData.forEach((d,i)=> miQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('mi'+i)}</div>`);
    const kiQ = document.getElementById('ki-q');
    kiData.forEach((d,i)=> kiQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('ki'+i)}</div>`);
    const kaQ = document.getElementById('ka-q');
    kaData.forEach((d,i)=> kaQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('ka'+i)}</div>`);
}
setup();

let results = { mi:null, ki:null, ka:null };

// ã»ã‚è¨€è‘‰ãƒ‡ãƒ¼ã‚¿
const praiseData = {
    "è¨€èª": "ğŸ‘„ ã€Œãã‚“ãªé›£ã—ã„è¨€è‘‰ã‚’çŸ¥ã£ã¦ã‚‹ã‚“ã ã­ï¼ã€ã€Œã‚ãªãŸã®è©±ã¯é¢ç™½ã„ã­ï¼ã€",
    "è«–ç†": "ğŸ”¢ ã€Œãªã‚‹ã»ã©ã€ãã†è€ƒãˆãŸã‚“ã ã­ï¼ã€ã€Œä»Šã®èª¬æ˜ã€ã™ã”ãåˆ†ã‹ã‚Šã‚„ã™ã‹ã£ãŸã‚ˆã€",
    "ç©ºé–“": "ğŸ¨ ã€Œè‰²ä½¿ã„ãŒç´ æ•µã ã­ï¼ã€ã€Œé ­ã®ä¸­ã«è¨­è¨ˆå›³ãŒã‚ã‚‹ã¿ãŸã„ã ã­ã€",
    "èº«ä½“": "ğŸ¤¸ ã€Œä»Šã®å‹•ãã€ã‹ã£ã“ã‚ˆã‹ã£ãŸï¼ã€ã€Œä¸€ç”Ÿæ‡¸å‘½ç·´ç¿’ã—ã¦ãŸã‚‚ã‚“ã­ã€",
    "éŸ³æ¥½": "ğŸµ ã€Œã„ã„ãƒªã‚ºãƒ ã ã­ï¼ã€ã€Œãã®æ­Œã‚’è´ãã¨ã€ã¿ã‚“ãªã‚‚æ¥½ã—ããªã‚‹ã‚ˆã€",
    "å¯¾äºº": "ğŸ‘« ã€Œå„ªã—ã„ã­ã€å‹é”ã‚‚å–œã‚“ã§ã‚‹ã‚ˆã€ã€Œã‚ãªãŸã®å‘¨ã‚Šã¯ã„ã¤ã‚‚ç¬‘é¡”ã ã­ã€",
    "å†…çœ": "ğŸ§˜ ã€Œè‡ªåˆ†ã®è€ƒãˆã‚’ã—ã£ã‹ã‚ŠæŒã£ã¦ã‚‹ã­ã€ã€Œä»Šã®ã“ã ã‚ã‚Šã€å¤§åˆ‡ã«ã—ã‚ˆã†ã€",
    "åšç‰©": "ğŸŒ² ã€Œç‰©çŸ¥ã‚Šã ã­ï¼å…ˆç”Ÿã¿ãŸã„ï¼ã€ã€Œãã‚“ãªç´°ã‹ã„é•ã„ã«æ°—ã¥ããªã‚“ã¦ã™ã”ã„ã€"
};

function calcMI() {
    let scores = {};
    miData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="mi${i}"]:checked`)?.value || 0);
        scores[d.c] = (scores[d.c] || 0) + val;
    });
    results.mi = scores;
    showMiChart(scores);
    const top = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    
    document.getElementById('mi-res').innerHTML = `
        <h3>ğŸŒŸ ãŠå­ã•ã‚“ã®ã€Œãã‚‰ã‚Šã€ï¼š${top}çš„ãªå¼·ã¿</h3>
        <p>ã“ã®åˆ†é‡ã®åˆºæ¿€ã‚’å—ã‘ã‚‹ã¨ã€è„³ãŒãã‚“ãã‚“æ´»æ€§åŒ–ã—ã¾ã™ã€‚</p>
        <div class="praise-box">âœ¨ <strong>é­”æ³•ã®ã»ã‚è¨€è‘‰ï¼š</strong><br>${praiseData[top]}</div>`;
    document.getElementById('mi-res').style.display = 'block';
    checkReady();
}

function showMiChart(scores) {
    const ctx = document.getElementById('miChart').getContext('2d');
    const labels = ["è¨€èª","è«–ç†","ç©ºé–“","èº«ä½“","éŸ³æ¥½","å¯¾äºº","å†…çœ","åšç‰©"];
    if(window.miRadar) window.miRadar.destroy();
    window.miRadar = new Chart(ctx, { type:'radar', data:{ labels, datasets:[{ label:'å¼·ã¿ã®ãƒãƒ©ãƒ³ã‚¹', data: labels.map(l=>scores[l]||0), backgroundColor:'rgba(255,127,127,0.2)', borderColor: '#ff7f7f', borderWidth:2 }]}, options:{ scales:{ r:{ min:0, max:8, ticks:{ display:false }}} }});
}

function calcKi() {
    let types = {};
    kiData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="ki${i}"]:checked`)?.value || 0);
        types[d.t] = (types[d.t] || 0) + val;
    });
    const main = Object.keys(types).reduce((a, b) => types[a] > types[b] ? a : b);
    const details = {
        "ãƒ‡ãƒªã‚±ãƒ¼ãƒˆ": "ğŸŒ¿ æ…é‡æ´¾ã§æ„Ÿå—æ€§è±Šã‹ãªã‚¿ã‚¤ãƒ—ã€‚å®‰å¿ƒæ„Ÿã‚’åœŸå°ã«æŒ‘æˆ¦ã‚’æ”¯ãˆã¾ã—ã‚‡ã†ã€‚",
        "ã‚¢ã‚¯ãƒ†ã‚£ãƒ–": "ğŸš€ å¥½å¥‡å¿ƒæ—ºç››ãªãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã€‚å®‰å…¨ã‚’å®ˆã‚Šã¤ã¤ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’è‚¯å®šã—ã¾ã—ã‚‡ã†ã€‚",
        "ã‚¨ãƒ³ã‚¸ã‚§ãƒ«": "ğŸŒ¸ èª¿å’Œã‚’é‡ã‚“ã˜ã‚‹å„ªã—ã„ã‚¿ã‚¤ãƒ—ã€‚æœ¬éŸ³ã‚’å¼•ãå‡ºã™é–¢ã‚ã‚Šã‚’å¤§åˆ‡ã«ã€‚",
        "ãƒ†ã‚­ã‚¹ãƒˆ": "ğŸ“š è¦å¾‹ã¨è¦‹é€šã—ã‚’å¥½ã‚€ã‚¿ã‚¤ãƒ—ã€‚å…·ä½“çš„ãªãƒ«ãƒ¼ãƒ«ãŒå®‰å¿ƒæ„Ÿã«ç¹‹ãŒã‚Šã¾ã™ã€‚",
        "ãƒã‚¬ãƒ†ã‚£ãƒ–": "âš¡ æƒ…ç†±çš„ã§ã“ã ã‚ã‚ŠãŒå¼·ã„ã‚¿ã‚¤ãƒ—ã€‚æ„Ÿæƒ…ã‚’ã¾ã‚‹ã”ã¨å—ã‘æ­¢ã‚ã‚‹åŒ…å®¹åŠ›ã‚’ã€‚"
    };
    results.ki = { type: main, detail: details[main] };
    document.getElementById('ki-res').innerHTML = `<h3>ğŸŒˆ ãŠå­ã•ã‚“ã®ã€Œã“ã“ã‚ã€ï¼š${main}ã‚¿ã‚¤ãƒ—</h3><p>${details[main]}</p>`;
    document.getElementById('ki-res').style.display = 'block';
    checkReady();
}

function calcKa() {
    let scores = {};
    kaData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="ka${i}"]:checked`)?.value || 0);
        scores[d.t] = (scores[d.t] || 0) + val;
    });
    const top = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    results.ka = { type: top };
    document.getElementById('ka-res').innerHTML = `<h3>ğŸ  ãŠå­ã•ã‚“ã®ã€Œãã‚‰ã—ã€ï¼š${top}ã®é…æ…®</h3><p>ãŠå­ã•ã‚“ã®è„³ã«å„ªã—ã„ç’°å¢ƒã¥ãã‚Šã®ãƒ’ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚</p>`;
    document.getElementById('ka-res').style.display = 'block';
    checkReady();
}

function checkReady() {
    let count = [results.mi, results.ki, results.ka].filter(r => r !== null).length;
    if(count >= 2) {
        document.getElementById('total-btn').disabled = false;
        document.getElementById('total-btn').innerHTML = `ğŸ“Š ç·åˆè¨ºæ–­ã‚’ç”Ÿæˆ (${count}/3 å›ç­”æ¸ˆ)`;
    }
}

function generateTotalDiagnosis() {
    const miTop = results.mi ? Object.keys(results.mi).reduce((a, b) => results.mi[a] > results.mi[b] ? a : b) : "ï¼ˆæœªå›ç­”ï¼‰";
    let html = `
        <div class="summary-box" style="border-left-color:var(--mi-color)">ğŸ¤ <strong>ã€Œå¼·ã¿ã€ã‚’æ´»ã‹ã™ï¼š${miTop}ã®åŠ›</strong><br>ã“ã®å­ã®å¾—æ„åˆ†é‡ã§ã™ã€‚èª²é¡Œã«å‘ãåˆã†æ™‚ã‚‚ã€ã“ã®å¼·ã¿ã‚’çµŒç”±ã™ã‚‹ã¨ã‚¹ãƒ ãƒ¼ã‚ºã§ã™ã€‚</div>
        <div class="summary-box" style="border-left-color:var(--ki-color)">ğŸ«‚ <strong>ã€Œæ°—è³ªã€ã«å¯„ã‚Šæ·»ã†ï¼š${results.ki ? results.ki.type : 'å¿ƒ'}ã¸ã®ç†è§£</strong><br>${results.ki ? results.ki.detail : 'ãŠå­ã•ã‚“ã®å€‹æ€§ã‚’å°Šé‡ã—ã¾ã—ã‚‡ã†ã€‚'}</div>
        <div class="summary-box" style="border-left-color:var(--ka-color)">ğŸ—ï¸ <strong>ã€Œç’°å¢ƒã€ã‚’æ•´ãˆã‚‹ï¼š${results.ka ? results.ka.type : 'ç”Ÿæ´»'}ã®å·¥å¤«</strong><br>è‹¦æ‰‹ã‚’å…‹æœã™ã‚‹ã®ã§ã¯ãªãã€ç’°å¢ƒã‚’æ•´ãˆã¦ã€Œè‹¦æ‰‹ã‚’ã‚«ãƒãƒ¼ã€ã—ã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚</div>
        
        <div class="message-box">
            <strong>ãŠçˆ¶ã•ã‚“ãƒ»ãŠæ¯ã•ã‚“ã¸</strong><br>
            æ¯æ—¥ã€æœ¬å½“ã«ãŠç–²ã‚Œæ§˜ã§ã™ã€‚ãŠå­ã•ã‚“ã®ã“ã¨ã‚’ã‚‚ã£ã¨ç†è§£ã—ãŸã„ã€ã©ã†æ”¯ãˆã‚Œã°ã„ã„ã‹çŸ¥ã‚ŠãŸã„â€¦â€¦ã€‚ãã†æ€ã£ã¦ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’æœ€å¾Œã¾ã§ä½¿ã£ã¦ãã ã•ã£ãŸã“ã¨è‡ªä½“ãŒã€ãŠå­ã•ã‚“ã¸ã®ä½•ã‚ˆã‚Šã®æ„›æƒ…ã®è¨¼ã§ã™ã€‚<br><br>
            ã€Œè¦ªã€ã¨ã„ã†å½¹å‰²ã¯ã€æ™‚ã«å­¤ç‹¬ã§ã€æ­£è§£ãŒè¦‹ãˆãªãã¦ä¸å®‰ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ã§ã‚‚ã€å®Œç’§ãªè¦ªã§ã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã“ã®çµæœã‚’è¦‹ã¦ã€ã€Œã‚ã€ã“ã‚Œã¯ã“ã®å­ã®å€‹æ€§ãªã‚“ã ã€ã¨ä¸€æ¯ã¤ã‘ãŸãªã‚‰ã€ãã‚Œã ã‘ã§ååˆ†ç´ æ™´ã‚‰ã—ã„ä¸€æ­©ã§ã™ã€‚
            ãŠå­ã•ã‚“ã¨ä¸€ç·’ã«ã€ã‚ãªãŸè‡ªèº«ã‚‚å¤§åˆ‡ã«ã—ã¦ãã ã•ã„ã­ã€‚
        </div>`;
    document.getElementById('total-content').innerHTML = html;
}

document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn, .tab-content').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
        if(btn.dataset.tab === 'total') {
            generateTotalDiagnosis();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    });
});

function saveImage() {
    const area = document.getElementById('capture-area');
    html2canvas(area).then(canvas => {
        const link = document.createElement('a');
        link.download = 'kodomo-support-nav.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>

</body>
</html>
