<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>子どもサポート・ナビ</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --mi-color: #ff7f7f; --ki-color: #ffb347; --ka-color: #76ba1b; --to-color: #4db8ff;
            --bg-color: #fffaf0; --text: #444;
        }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-color); color: var(--text); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { max-width: 600px; width: 100%; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); border: 2px solid #eee; position: relative; }
        
        /* タイトルと注意書き */
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-size: 1.6rem; color: #d48344; margin: 10px 0; }
        .intro-box { background: #fff5e6; border-radius: 15px; padding: 15px; font-size: 0.85rem; line-height: 1.6; border: 1px solid #f9e2c4; text-align: left; margin-bottom: 20px; }
        .intro-box strong { color: #d48344; }

        /* タブ */
        .tab-menu { display: flex; gap: 4px; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 10px 2px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; background: #f0f0f0; transition: 0.3s; font-family: inherit; font-size: 0.75rem; color: #888; }
        .tab-btn.active { color: white; }
        .tab-btn[data-tab="mi"].active { background: var(--mi-color); }
        .tab-btn[data-tab="kishitsu"].active { background: var(--ki-color); }
        .tab-btn[data-tab="kankyo"].active { background: var(--ka-color); }
        .tab-btn[data-tab="total"].active { background: var(--to-color); }
        .tab-btn:disabled { opacity: 0.3; }

        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* 質問スタイル (スマホ向けにボタン化) */
        .q-block { margin-bottom: 20px; padding: 15px; border-radius: 15px; border: 1px solid #eee; background: #fff; }
        .q-text { font-weight: bold; font-size: 0.95rem; margin-bottom: 12px; display: block; color: #333; }
        
        .radio-group { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .radio-label { text-align: center; font-size: 0.65rem; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .radio-label input { margin-bottom: 8px; width: 22px; height: 22px; cursor: pointer; }

        .btn { width: 100%; padding: 16px; color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 15px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
        .btn-save { background: #999; margin-top: 10px; font-size: 0.9rem; }
        
        /* 結果表示 */
        .res-area { margin-top: 20px; padding: 20px; border-radius: 20px; display: none; border-left: 8px solid; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .total-card { padding: 15px; border-radius: 20px; background: white; }
        .summary-box { background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #eee; border-left: 8px solid #ccc; font-size: 0.9rem; }
        
        #chart-container { width: 100%; max-width: 350px; margin: 15px auto; }
        
        @media print { .tab-menu, .btn, .intro-box, .q-block { display: none !important; } .container { border: none; box-shadow: none; } }
    </style>
</head>
<body>

<div class="container" id="app-container">
    <div class="header">
        <h1>🌱 子どもサポート・ナビ</h1>
    </div>

    <div class="intro-box">
        🕊️ <strong>このツールの目的</strong><br>
        この診断は、お子さんを特定の「型」にはめたり、可能性を決めつけるためのものではありません。<br><br>
        「なぜ、あんな行動をするんだろう？」という疑問を<strong>「理解のヒント」</strong>に変え、親子がもっと楽に、自分らしく笑い合えるコミュニケーションを探るためのガイドです。お子さんの成長を温かく支えるための、一つの視点としてご活用ください。
    </div>
    
    <div class="tab-menu">
        <button class="tab-btn active" data-tab="mi">✨きらり<br>(強み)</button>
        <button class="tab-btn" data-tab="kishitsu">🌈こころ<br>(性格)</button>
        <button class="tab-btn" data-tab="kankyo">🏠くらし<br>(環境)</button>
        <button class="tab-btn" data-tab="total" id="total-btn" disabled>📊 総合診断</button>
    </div>

    <div id="mi" class="tab-content active">
        <p style="text-align:center; font-size:0.9rem;">🎨 お子さんの「これ、好きかも！」を選んでね</p>
        <div id="mi-q"></div>
        <button class="btn" style="background:var(--mi-color)" onclick="calcMI()">強みのヒントを見る 🔍</button>
        <div id="chart-container"><canvas id="miChart"></canvas></div>
        <div id="mi-res" class="res-area" style="background:#fffafa; border-color:var(--mi-color)"></div>
    </div>

    <div id="kishitsu" class="tab-content">
        <p style="text-align:center; font-size:0.9rem;">🍃 生まれ持った「心のクセ」を教えてね</p>
        <div id="ki-q"></div>
        <button class="btn" style="background:var(--ki-color)" onclick="calcKi()">気質のヒントを見る 🔍</button>
        <div id="ki-res" class="res-area" style="background:#fffdf5; border-color:var(--ki-color)"></div>
    </div>

    <div id="kankyo" class="tab-content">
        <p style="text-align:center; font-size:0.9rem;">🛋️ 日常の「ちょっと困った」の背景を探ろう</p>
        <div id="ka-q"></div>
        <button class="btn" style="background:var(--ka-color)" onclick="calcKa()">環境のヒントを見る 🔍</button>
        <div id="ka-res" class="res-area" style="background:#fafffa; border-color:var(--ka-color)"></div>
    </div>

    <div id="total" class="tab-content">
        <div class="total-card" id="capture-area">
            <h2 style="text-align:center; color:var(--to-color); font-size:1.3rem;">🤝 お子さんへの伴走ガイド</h2>
            <div id="total-content"></div>
        </div>
        <button class="btn" style="background:var(--to-color)" onclick="window.print()">🖨️ 結果を印刷する</button>
        <button class="btn btn-save" onclick="saveImage()">📸 スマホに画像で保存</button>
    </div>
</div>

<script>
// --- 5段階UI生成 ---
function create5Scale(name) {
    return `
    <div class="radio-group">
        <label class="radio-label"><input type="radio" name="${name}" value="4">よく<br>あてはまる</label>
        <label class="radio-label"><input type="radio" name="${name}" value="3">あてはまる</label>
        <label class="radio-label"><input type="radio" name="${name}" value="2">わから<br>ない</label>
        <label class="radio-label"><input type="radio" name="${name}" value="1">あまり<br>あてはまらない</label>
        <label class="radio-label"><input type="radio" name="${name}" value="0">あてはま<br>らない</label>
    </div>`;
}

// --- 質問データ (絵文字入り) ---
const miData = [
    { c: "言語", q: "📚 難しい言葉を使ったり、おしゃべりを楽しんだりする" }, { c: "言語", q: "📖 絵本の読み聞かせや、物語を作るのが好き" },
    { c: "論理", q: "🧩 パズルや、モノを並べて分類するのが得意" }, { c: "論理", q: "🔍 「なぜ？どうして？」と仕組みを知りたがる" },
    { c: "空間", q: "🗺️ 地図を覚えたり、絵の奥行きを捉えるのが上手" }, { c: "空間", q: "🏰 ブロックやレゴで立体的なモノを作るのが好き" },
    { c: "身体", q: "🏃‍♂️ ダンスやスポーツ、体の使い方が器用" }, { c: "身体", q: "✂️ 工作や料理など、手先を細かく動かすのが得意" },
    { c: "音楽", q: "🎶 鼻歌を歌ったり、リズムに乗るのが自然と出る" }, { c: "音楽", q: "🎹 楽器や、生活の中の「音」に敏感に反応する" },
    { c: "対人", q: "🤝 友達の気持ちを察したり、仲直りさせるのが上手" }, { c: "対人", q: "🏫 みんなと一緒に何かをする時間を楽しめる" },
    { c: "内省", q: "🧘 自分の意志がはっきりしていて、流されない強さがある" }, { c: "内省", q: "💭 ひとりで静かに考えに没頭する時間を大切にする" },
    { c: "博物", q: "🦖 恐竜、植物、石など特定の収集や観察が大好き" }
];

const kiData = [
    { t: "デリケート", q: "👂 音や光、肌触りなどの刺激にとても敏感" }, { t: "デリケート", q: "😟 失敗を怖がったり、完璧にやりたい気持ちが強い" }, { t: "デリケート", q: "🌳 初めての場所では、安全を確認するまで動かない" },
    { t: "アクティブ", q: "🚀 興味があると考えるより先に体が動いている" }, { t: "アクティブ", q: "🔥 声が大きく、全身からエネルギーが溢れている" },
    { t: "エンジェル", q: "🌸 基本的に穏やかで、周りの期待に応えようとする" }, { t: "エンジェル", q: "🤝 自分の主張より、みんなの調和を優先させがち" },
    { t: "テキスト", q: "⏰ 決まったルーチンを好み、急な変更は苦手" }, { t: "テキスト", q: "📉 「10分だけ」など具体的な数字やルールが安心する" },
    { t: "ネガティブ", q: "⚡ 感情が爆発すると、落ち着くまでに時間がかかる" }, { t: "ネガティブ", q: "💎 自分のこだわりが強く、納得しないとテコでも動かない" },
    { t: "デリケート", q: "👀 大人の表情や空気を読みすぎて疲れることがある" }, { t: "アクティブ", q: "🏃‍♂️ 退屈が苦手で、常に何かの刺激を求めている" }, { t: "テキスト", q: "📦 自分の大切なものを整理・整頓するのが好き" }, { t: "エンジェル", q: "🕊️ 争いごとが苦手で、みんな仲良くいてほしいと願う" }
];

const kaData = [
    { t: "視覚支援", q: "📢 言葉だけの指示だと、すぐに忘れてしまう" }, { t: "視覚支援", q: "🖼️ 写真やイラストで見せてもらう方がスッと入る" }, { t: "視覚支援", q: "📅 スケジュールが目に見えるところにあると安心する" },
    { t: "聴覚配慮", q: "👂 ガヤガヤした場所だと、声が聞き取れず混乱する" }, { t: "聴覚配慮", q: "🎧 イヤーマフや静かな場所があるとホッとできる" },
    { t: "構造化", q: "🧺 物の片付け場所が決まっていないと迷子になる" }, { t: "構造化", q: "🪜 手順を一つずつ「1, 2, 3...」と分けてほしい" },
    { t: "感覚統合", q: "👕 服のタグや特定の食べ物の感触をひどく嫌がる" }, { t: "感覚統合", q: "🌀 くるくる回るものや、高いところが大好き" },
    { t: "実行機能", q: "⏸️ 夢中になると、次の行動への切り替えが難しい" }, { t: "実行機能", q: "📝 忘れ物や、物の紛失がどうしても多くなってしまう" }, { t: "実行機能", q: "⏳ 時間の流れが掴みにくく、いつも慌ててしまう" },
    { t: "感覚統合", q: "🧸 ぎゅっと抱きしめられるなど、圧迫刺激で落ち着く" }, { t: "実行機能", q: "🎒 準備をする際、何をすべきか順番がわからなくなる" }, { t: "構造化", q: "🤫 集中したい時は、囲われた静かなブースが落ち着く" }
];

function setup() {
    const miQ = document.getElementById('mi-q');
    miData.forEach((d,i)=> miQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('mi'+i)}</div>`);
    const kiQ = document.getElementById('ki-q');
    kiData.forEach((d,i)=> kiQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('ki'+i)}</div>`);
    const kaQ = document.getElementById('ka-q');
    kaData.forEach((d,i)=> kaQ.innerHTML += `<div class="q-block"><span class="q-text">${i+1}. ${d.q}</span>${create5Scale('ka'+i)}</div>`);
}
setup();

let results = { mi:null, ki:null, ka:null };

function calcMI() {
    let scores = {};
    miData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="mi${i}"]:checked`)?.value || 0);
        scores[d.c] = (scores[d.c] || 0) + val;
    });
    results.mi = scores;
    showMiChart(scores);
    const top = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    
    const details = {
        "言語": "👄 <strong>【あるある】</strong> 言葉の面白さに敏感！大人と対等に話したがることがあります。<br>💡 <strong>【ヒント】</strong> 「対話」を通して教えるのが効果的。物語や比喩を使うとスッと伝わります。",
        "論理": "🔢 <strong>【あるある】</strong> 納得感重視！「なぜダメなの？」の理由を論理的に知りたがります。<br>💡 <strong>【ヒント】</strong> ルールを可視化し、根拠を説明すると納得して動けます。数字も大好き。",
        "空間": "🎨 <strong>【あるある】</strong> 頭の中にカメラがある！言葉で聞くより、図や映像で見る方が得意です。<br>💡 <strong>【ヒント】</strong> 図解、動画、写真。目で見て分かる情報を増やすと、劇的に理解が進みます。",
        "身体": "🤸 <strong>【あるある】</strong> 考えるより先に体が動く！実際にやってみることで理解を深めます。<br>💡 <strong>【ヒント】</strong> 体験型学習がベスト。体を動かしながらの方が、脳も活発に動きます。",
        "音楽": "🎵 <strong>【あるある】</strong> リズムで生きている！鼻歌を歌いながらの方が作業が捗ることも。<br>💡 <strong>【ヒント】</strong> 歌にして覚える、BGMを活用する。聴覚的なアクセントがやる気を引き出します。",
        "対人": "👫 <strong>【あるある】</strong> 空気を読む名人！誰かの役に立ちたいという気持ちが強いです。<br>💡 <strong>【ヒント】</strong> ペア学習や、誰かを助ける「役割」を与えると、大きな力を発揮します。",
        "内省": "🧘 <strong>【あるある】</strong> 自分のペースを守る人！自分に厳しく、納得してから動きたいタイプ。<br>💡 <strong>【ヒント】</strong> 一人で考える時間を尊重して。自分で選ばせることで自立心が育ちます。",
        "博物": "🌲 <strong>【あるある】</strong> 観察の天才！好きな分野の細かな違いを驚くほど見つけます。<br>💡 <strong>【ヒント】</strong> 興味のある対象（例：電車、虫）をあらゆる学びに結びつけて伴走しましょう。"
    };

    document.getElementById('mi-res').innerHTML = `<h3>🌟 お子さんの「きらり」：${top}的知能</h3><p>${details[top]}</p>`;
    document.getElementById('mi-res').style.display = 'block';
    checkReady();
}

function showMiChart(scores) {
    const ctx = document.getElementById('miChart').getContext('2d');
    const labels = ["言語","論理","空間","身体","音楽","対人","内省","博物"];
    if(window.miRadar) window.miRadar.destroy();
    window.miRadar = new Chart(ctx, { type:'radar', data:{ labels, datasets:[{ label:'強みのバランス', data: labels.map(l=>scores[l]||0), backgroundColor:'rgba(255,127,127,0.2)', borderColor: '#ff7f7f', borderWidth:2 }]}, options:{ scales:{ r:{ min:0, max:8, ticks:{ display:false }}} }});
}

function calcKi() {
    let types = {};
    kiData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="ki${i}"]:checked`)?.value || 0);
        types[d.t] = (types[d.t] || 0) + val;
    });
    const main = Object.keys(types).reduce((a, b) => types[a] > types[b] ? a : b);
    const details = {
        "デリケート": "🌿 <strong>【あるある】</strong> 石橋を叩いて渡る慎重派。失敗を極端に嫌がることがあります。<br>💡 <strong>【ヒント】</strong> 無理に押さず、本人が安全だと確信するまで「待つ」のが一番の近道です。",
        "アクティブ": "🚀 <strong>【あるある】</strong> 好奇心爆発！危ないことでも飛び込んで、後でびっくりします。<br>💡 <strong>【ヒント】</strong> 叱るより「予告」と「環境整備」。エネルギーを発散できる場所を多めに用意して。",
        "エンジェル": "🌸 <strong>【あるある】</strong> 穏やかで育てやすい。でも、自分の本音をグッと堪えていることも。<br>💡 <strong>【ヒント】</strong> 「本当はどう思ってる？」と本音を拾い上げる時間を意識的に作ってあげて。",
        "テキスト": "📚 <strong>【あるある】</strong> 規律正しく、見通しが必要。想定外のことにパニックになることも。<br>💡 <strong>【ヒント】</strong> 予定の変更は早めに。具体的で論理的な説明が本人の安心感に直結します。",
        "ネガティブ": "⚡ <strong>【あるある】</strong> 情熱家で激しい！自分の思い通りにならないと全力で抵抗します。<br>💡 <strong>【ヒント】</strong> 感情を一度「まるごと」受け止めて。落ち着いてから交渉を始めましょう。"
    };
    results.ki = { type: main, detail: details[main] };
    document.getElementById('ki-res').innerHTML = `<h3>🌈 お子さんの「こころ」：${main}タイプ</h3><p>${details[main]}</p>`;
    document.getElementById('ki-res').style.display = 'block';
    checkReady();
}

function calcKa() {
    let scores = {};
    kaData.forEach((d,i) => {
        const val = parseInt(document.querySelector(`input[name="ka${i}"]:checked`)?.value || 0);
        scores[d.t] = (scores[d.t] || 0) + val;
    });
    const top = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    const details = {
        "視覚支援": "🖼️ <strong>【傾向】</strong> 耳からの指示より、目からの情報が安心材料になります。<br>💡 <strong>【対応】</strong> 写真、絵カード、タイマー。目で見て「今何をするか」が分かる環境を。",
        "聴覚配慮": "🎧 <strong>【傾向】</strong> ざわつきが頭の中で混ざってしまい、疲れやすいです。<br>💡 <strong>【対応】</strong> 静かな「避難場所」の確保。指示を出す時は一対一で、騒音を避けて伝えて。",
        "構造化": "📦 <strong>【傾向】</strong> 整理されていない空間だと、脳が混乱して動きが止まります。<br>💡 <strong>【対応】</strong> 定位置を決め、ラベルを貼る。手順を小分けにしてリスト化しましょう。",
        "感覚統合": "🌀 <strong>【傾向】</strong> 脳の感覚の受け取り方に個性があります。嫌な感触、好きな感触がハッキリ。<br>💡 <strong>【対応】</strong> 不快な刺激を無理強いせず、好きな刺激（揺れや圧迫）を遊びで満たして。",
        "実行機能": "⏳ <strong>【傾向】</strong> 切り替えや記憶の保持にエネルギーが必要です。<br>💡 <strong>【対応】</strong> チェックリストや「あと5分」の予告。外付けの司令塔として伴走してあげて。"
    };
    results.ka = { type: top, detail: details[top] };
    document.getElementById('ka-res').innerHTML = `<h3>🏠 お子さんの「くらし」：${top}の配慮</h3><p>${details[top]}</p>`;
    document.getElementById('ka-res').style.display = 'block';
    checkReady();
}

function checkReady() {
    let count = [results.mi, results.ki, results.ka].filter(r => r !== null).length;
    if(count >= 2) {
        document.getElementById('total-btn').disabled = false;
        document.getElementById('total-btn').innerHTML = `📊 総合診断を生成 (${count}/3 回答済)`;
    }
}

function generateTotalDiagnosis() {
    const miTop = results.mi ? Object.keys(results.mi).reduce((a, b) => results.mi[a] > results.mi[b] ? a : b) : "（未回答）";
    let html = `
        <div class="summary-box" style="border-left-color:var(--mi-color)">🤝 <strong>「強み」を活かす</strong><br>${miTop}の力を活用しましょう。得意なことで自信を貯金していく時期です。</div>
        <div class="summary-box" style="border-left-color:var(--ki-color)">🫂 <strong>「気質」に寄り添う</strong><br>${results.ki ? results.ki.detail : '性格を尊重した声かけを。'}</div>
        <div class="summary-box" style="border-left-color:var(--ka-color)">🏗️ <strong>「環境」を整える</strong><br>${results.ka ? results.ka.detail : '過ごしやすい場作りを。'}</div>
        <div style="background:#fff7f7; padding:20px; border-radius:15px; border:2px dashed #ff7f7f; font-size:0.9rem; line-height:1.7;">
            <strong>💎 総合伴走アドバイス：</strong><br>
            お子さんの行動には必ず「理由」があります。${results.ka ? results.ka.type : '環境'}の調整で物理的なハードルを下げ、${miTop}の強みで「できた！」を増やしましょう。<br><br>
            大切なのは、大人がお子さんの「通訳者」になること。この子の素晴らしい個性が、今の環境の中で一番良い形で発揮されるよう、一歩引いて、そして隣に座って見守っていきましょう。
        </div>`;
    document.getElementById('total-content').innerHTML = html;
}

document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn, .tab-content').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
        if(btn.dataset.tab === 'total') {
            generateTotalDiagnosis();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    });
});

function saveImage() {
    const area = document.getElementById('capture-area');
    html2canvas(area).then(canvas => {
        const link = document.createElement('a');
        link.download = 'kodomo-support-nav.png';
        link.href = canvas.toDataURL();
        link.click();
    });
}
</script>

</body>
</html>
